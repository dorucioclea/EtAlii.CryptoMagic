@page "/circular/view/{id?}"

@namespace EtAlii.BinanceMagic.Service

@inherits ViewBase<CircularTradeSnapshot, CircularTrading, CircularAlgorithmRunner>

<Heading Margin="Margin.Is4">@Model.Name</Heading>

<Row Margin="Margin.Is4">
    <Column ColumnSize="ColumnSize.Is1">
        <Blazorise.Button Color="Color.Primary" Type="ButtonType.Link" Size="Size.Small">
            <Icon Name="IconName.Pause" />
            Pause
        </Blazorise.Button>
    </Column>
    <Column ColumnSize="ColumnSize.Is1">
        <Blazorise.Button Color="Color.Secondary" Type="ButtonType.Link" To="@($"/circular/edit/{Id}")" Size="Size.Small">
            <Icon Name="@("fa-wrench")"/>
            Change
        </Blazorise.Button>
    </Column>
</Row>
<Row Margin="Margin.Is4">
    <Column ColumnSize="ColumnSize.Is4.OnDesktop.IsAuto.OnTablet">
        <Card>
            <CardHeader>Summary</CardHeader>
            <Table Striped="false" Borderless="true" Narrow="true">
                <TableBody>
                    <TableRow>
                        <TableRowCell>Last success:</TableRowCell><TableRowCell>@LastSuccess</TableRowCell>
                    </TableRow>
                    <TableRow>
                        <TableRowCell>Next check:</TableRowCell><TableRowCell>@NextCheck</TableRowCell>
                    </TableRow>
                    <TableRow>
                        <TableRowCell>Step:</TableRowCell><TableRowCell>@Current.Step</TableRowCell>
                    </TableRow>
                    <TableRow>
                        <TableRowCell>Profit:</TableRowCell><TableRowCell>@($"{CurrentRunner.Context.Trading.TotalProfit:0.00} {CurrentRunner.Context.Trading.ReferenceSymbol}")</TableRowCell>
                    </TableRow>
                    <TableRow>
                        <TableRowCell>Result:</TableRowCell><TableRowCell>@Current.Result</TableRowCell>
                    </TableRow>
                </TableBody>
            </Table>
        </Card>        
    </Column>
</Row>

<Row Margin="Margin.Is4">
    <Column ColumnSize="ColumnSize.Is8.OnDesktop.IsAuto.OnTablet">
        <CircularTradeSnapshotCard 
            Title="Current cycle" 
            Snapshot="@CurrentRunner.Context.Snapshot"
            Trading="@CurrentRunner.Context.Trading"/>
    </Column>    
</Row>

<Repeater Items="@History">
    <Row Margin="Margin.Is4">
        <Column ColumnSize="ColumnSize.Is8.OnDesktop.IsAuto.OnTablet">
            <CircularTradeSnapshotCard 
                Title="@($"Cycle {context.LastSuccess}")" 
                Snapshot="@context" 
                Trading="@CurrentRunner.Context.Trading"/>
        </Column>
    </Row>
</Repeater>

<Row Margin="Margin.Is4">
    <Column ColumnSize="ColumnSize.Is8.OnDesktop.IsAuto.OnTablet">
        <Card>
            <CardHeader>Backtest startup</CardHeader>
            <CardBody>@CurrentRunnerLog</CardBody>
        </Card>        
    </Column>
</Row>
